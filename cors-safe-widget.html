<style>
/* Hide ALL subscription CTAs */
.gh-subscribe-form, .subscribe-form, .newsletter-signup, .portal-cta, .subscribe-cta, .gh-portal-cta,
[class*="subscribe"], [class*="newsletter"], [class*="portal"], [class*="signup"],
footer .subscribe, footer .newsletter, .footer-cta, .site-footer .portal-cta { display: none !important; }

/* AMOLED Black Bluesky Widget */
#bluesky-widget { 
  background: #000000; 
  border-radius: 12px; 
  padding: 20px; 
  max-width: 600px; 
  margin: 20px auto; 
  font-family: sans-serif; 
}
.bluesky-post { 
  border: 1px solid #1a1a1a; 
  border-radius: 12px; 
  padding: 16px; 
  margin-bottom: 16px; 
  background: #000000; 
  color: #ffffff; 
}
.bluesky-post-header { 
  display: flex; 
  align-items: center; 
  gap: 12px; 
  margin-bottom: 12px; 
}
.bluesky-avatar { 
  width: 40px; 
  height: 40px; 
  border-radius: 50%; 
  background: #333; 
}
.bluesky-author { flex: 1; }
.bluesky-display-name { 
  font-weight: 600; 
  color: #ffffff; 
  margin: 0; 
}
.bluesky-handle { 
  color: #8899a6; 
  font-size: 14px; 
  margin: 0; 
}
.bluesky-text { 
  margin: 12px 0; 
  line-height: 1.5; 
  color: #ffffff; 
}
.bluesky-post-link { 
  color: #1da1f2; 
  text-decoration: none; 
  font-size: 14px; 
}

/* Hide widget anywhere except home */
body:not(.home-template) #bluesky-widget { display: none !important; }
</style>

<script>
(function() {
  console.log('Bluesky widget loading...');

  var isHome = document.body.classList.contains('home-template') || window.location.pathname === '/';
  if (!isHome) {
    console.log('Not on home page, skipping widget');
    return;
  }

  function createWidget() {
    var widget = document.createElement('div');
    widget.id = 'bluesky-widget';
    
    var headerHTML = '<div style="margin-bottom:20px;padding:15px;background:linear-gradient(135deg,#0085ff 0%,#00a8ff 100%);border-radius:12px;">';
    headerHTML += '<h3 style="margin:0;color:white;font-size:18px;">Recent Bluesky Posts</h3>';
    headerHTML += '</div>';
    headerHTML += '<div id="bluesky-posts">Loading posts...</div>';
    
    widget.innerHTML = headerHTML;
    
    var target = document.querySelector('main') || document.querySelector('.gh-main') || document.body;
    target.appendChild(widget);
    
    console.log('Widget created and added to page');
    return widget;
  }

  function loadPosts() {
    var postsContainer = document.getElementById('bluesky-posts');
    if (!postsContainer) return;

    postsContainer.innerHTML = '<div style="text-align:center;color:#8899a6;padding:20px;">Fetching posts...</div>';

    var url = '/content/images/bluesky-feed.json?t=' + Date.now();
    console.log('Fetching from:', url);

    fetch(url, { 
      method: 'GET',
      cache: 'no-cache'
    })
    .then(function(response) {
      console.log('Response status:', response.status);
      if (!response.ok) {
        throw new Error('HTTP ' + response.status);
      }
      return response.json();
    })
    .then(function(data) {
      console.log('Data received:', data);
      
      if (data && data.posts && data.posts.length > 0) {
        var html = '';
        for (var i = 0; i < data.posts.length; i++) {
          var post = data.posts[i];
          html += '<div class="bluesky-post">';
          html += '<div class="bluesky-post-header">';
          if (post.author && post.author.avatar) {
            html += '<img src="' + post.author.avatar + '" class="bluesky-avatar" alt="">';
          }
          html += '<div class="bluesky-author">';
          html += '<p class="bluesky-display-name">' + (post.author ? post.author.displayName : 'Unknown') + '</p>';
          html += '<p class="bluesky-handle">@' + (post.author ? post.author.handle : '') + '</p>';
          html += '</div>';
          html += '</div>';
          html += '<div class="bluesky-text">' + (post.text || '') + '</div>';
          if (post.blueskyUrl) {
            html += '<p><a href="' + post.blueskyUrl + '" target="_blank" class="bluesky-post-link">View on Bluesky</a></p>';
          }
          html += '</div>';
        }
        postsContainer.innerHTML = html;
      } else {
        postsContainer.innerHTML = '<p style="color:#8899a6;text-align:center;">No posts found</p>';
      }
    })
    .catch(function(error) {
      console.error('Error loading posts:', error);
      postsContainer.innerHTML = '<div style="text-align:center;color:#ff6b6b;padding:20px;">Unable to load posts. <a href="https://bsky.app/profile/benwest.bsky.social" target="_blank" style="color:#1da1f2;">View on Bluesky</a></div>';
    });
  }

  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      createWidget();
      setTimeout(loadPosts, 500);
    });
  } else {
    createWidget();
    setTimeout(loadPosts, 500);
  }

})();
</script>